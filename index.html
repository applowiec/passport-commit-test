<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Ethereum Activity Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; background: #fafafa; }
    h1 { color: #333; }
    table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
    th, td { border: 1px solid #ddd; padding: 6px; text-align: left; }
    th { background: #333; color: #fff; }
    tr:nth-child(even) { background: #f2f2f2; }
    input, button { padding: 6px; margin: 5px 0; }
    .controls { margin: 1rem 0; }
    .pagination { margin-top: 1rem; }
    .pagination button { margin-right: 10px; }
  </style>
</head>
<body>
  <h1>Ethereum Activity Viewer</h1>

  <div class="controls">
    <label>Adres portfela:</label><br>
    <input type="text" id="address" size="60" placeholder="0x..."><br><br>

    <label><input type="radio" name="mode" value="eth" checked> Transakcje ETH</label><br>
    <label><input type="radio" name="mode" value="erc20"> Transakcje ERC20</label><br><br>

    <button onclick="loadData(1)">Załaduj</button>
  </div>

  <h2>Transakcje</h2>
  <table id="txTable">
    <thead>
      <tr>
        <th>Data</th>
        <th>Token / ETH</th>
        <th>Kwota</th>
        <th>Od</th>
        <th>Do</th>
        <th>Tx Hash</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="pagination">
    <button onclick="prevPage()">◀ Poprzednia</button>
    <span id="pageInfo">Strona 1</span>
    <button onclick="nextPage()">Następna ▶</button>
  </div>

  <script>
    let currentPage = 1;
    let currentMode = "eth";
    let currentAddr = "";
    const pageSize = 100;

    async function loadData(page) {
      const addr = document.getElementById("address").value.trim();
      if (!addr) return alert("Podaj adres!");
      currentAddr = addr;
      currentPage = page;
      currentMode = document.querySelector("input[name='mode']:checked").value;

      let url = "";
      if (currentMode === "eth") {
        url = `https://etherscan-proxy.my-eth.workers.dev/eth?address=${addr}&page=${page}&offset=${pageSize}`;
      } else {
        url = `https://etherscan-proxy.my-eth.workers.dev/erc20?address=${addr}&page=${page}&offset=${pageSize}`;
      }

      const res = await fetch(url);
      const data = await res.json();

      const tbody = document.querySelector("#txTable tbody");
      tbody.innerHTML = "";

      if (data.status !== "1" || !data.result.length) {
        tbody.innerHTML = `<tr><td colspan="6">Brak danych (${data.message || "empty"})</td></tr>`;
        return;
      }

      data.result.forEach(tx => {
        const row = document.createElement("tr");
        const date = new Date(tx.timeStamp * 1000).toLocaleString();
        let amount;
        let token;

        if (currentMode === "eth") {
          amount = (parseFloat(tx.value) / 1e18).toFixed(6);
          token = "ETH";
        } else {
          amount = (parseFloat(tx.value) / Math.pow(10, tx.tokenDecimal)).toFixed(4);
          token = tx.tokenSymbol;
        }

        row.innerHTML = `
          <td>${date}</td>
          <td>${token}</td>
          <td>${amount}</td>
          <td>${tx.from}</td>
          <td>${tx.to}</td>
          <td><a href="https://etherscan.io/tx/${tx.hash}" target="_blank">${tx.hash.slice(0,12)}...</a></td>
        `;
        tbody.appendChild(row);
      });

      document.getElementById("pageInfo").innerText = `Strona ${currentPage}`;
    }

    function prevPage() {
      if (currentPage > 1) {
        loadData(currentPage - 1);
      }
    }

    function nextPage() {
      loadData(currentPage + 1);
    }
  </script>
</body>
</html>
